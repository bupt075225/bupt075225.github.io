这篇文章描述如何为CentOS 7服务器设置防火墙，使用firewall-cmd管理工具对防火墙进行管理。

### 基本概念

在开始介绍firewall-cmd工具之前，先了解一下`firewalld`相关的几个基本概念。

- Zones

`firewalld`守护进程使用网络分区(zone)来管理安全策略，分区是策略的集合，决定了服务器连接的网络收发包策略。服务器所连接的网络通常是固定且单一的，所以一般只会使用到一个网络分区，而像笔记本电脑这类便携网络设备时常连接到不同的网络，有不同的信任度，例如连接到家庭网络，工作网络，公共WiFi网络对所连接网络的信任度是不一样的，这就可以通过网络分区来灵活地设置不同的安全策略集。按照可信任度高低，`firewalld`预设了一些网络分区：drop,block,public,external,internal,dmz,work,home,trusted。

- 永久策略

`firewalld`的一个重要特性是动态修改安全策略，即修改立即生效，不需要重启防火墙服务。设置的安全策略可以是临时或永久生效，默认新修改的策略是临时生效，重启防火墙后策略恢复到修改前。如果要设置成永久生效的策略，需要加上`--permanent`选项。

### 打开防火墙

启动防火墙服务，打开防火墙：

	$ systemctl start firewalld

查看防火墙运行状态：

	$ firewall-cmd --state
	running

### 查看防火墙当前配置

在开始修改防火墙安全策略之前，先查看一下当前默认设置。

1.查看默认使用的哪个网络分区：

	$ firewall-cmd --get-default-zone
	public

2.查看有哪些活动分区：

	$ firewall-cmd --get-active-zones

3.查看默认分区(public)已设置了哪些安全策略：

	$ firewall-cmd --list-all
	public (default)
	  interfaces: 
	  sources: 
	  services: dhcpv6-client ssh
	  ports: 
	  masquerade: no
	  forward-ports: 
	  icmp-blocks: 
	  rich rules: 

查询结果显示，默认分区是public分区，但没有被激活，没有网络接口加入到该分区，允许dhcp和ssh两个服务。


4.查看其它分区

列出当前所有分区：

	$ firewall-cmd --get-zones
	block dmz drop external home internal public trusted work

通过`--zone=`参数指定分区名来查看该分区的详细策略配置：

	$ firewall-cmd --zone=home --list-all
	home
	  interfaces: 
	  sources: 
	  services: dhcpv6-client ipp-client mdns samba-client ssh
	  ports: 
	  masquerade: no
	  forward-ports: 
	  icmp-blocks: 
	  rich rules: 

查看所有分区的策略配置：

	$ firewall-cmd --list-all-zones | less


### 修改防火墙配置

1.添加网络接口到网络分区

如果在前面的查询中发现没有网络接口被加入到分区，使用如下命令向默认分区中加入一个网络接口：

	$ firewall-cmd --add-interface=eth0 --permanent

查看配置是否已生效：

	$ firewall-cmd --get-active-zones
	public
	  interfaces: eth0

2.添加服务到网络分区

首先使用`--get-services`选项查看所有可用的服务：

	$ firewall-cmd --get-services
	RH-Satellite-6 amanda-client bacula bacula-client dhcp dhcpv6 dhcpv6-client dns freeipa-ldap freeipa-ldaps freeipa-replication ftp high-availability http https imaps ipp ipp-client ipsec iscsi-target kerberos kpasswd ldap ldaps libvirt libvirt-tls mdns mountd ms-wbt mysql nfs ntp openvpn pmcd pmproxy pmwebapi pmwebapis pop3s postgresql proxy-dhcp radius rpc-bind rsyncd samba samba-client smtp ssh telnet tftp tftp-client transmission-client vdsm vnc-server wbem-https

添加一个服务到zone，如果是向默认zone添加服务，则可以不用--zone选项。
	
	$ firewall-cmd --zone=public --add-service=http --permanent
	success

	$ systemctl restart firewalld
	$ firewall-cmd --list-all
	public (default, active)
	  interfaces: eth0
	  sources: 
	  services: dhcpv6-client http ssh
	  ports: 
	  masquerade: no
	  forward-ports: 
	  icmp-blocks: 
	  rich rules: 

使用如下的命令可查看添加服务是否成功：

	$ firewall-cmd --zone=public --list-services --permanent
	dhcpv6-client http https ssh
	
3.打开端口

防火墙囊括的服务能满足绝大多数访问需求，但也存在一些场景需要访问的服务使用非常用端口，例如通过非80端口访问HTTP服务，这种情况需要打开端口的访问权限，可以指定打开一个端口或一个范围内的端口以及端口对应的协议类型。

例如，通过TCP连接从8081端口访问HTTP服务：

	firewall-cmd --zone=public --permanent --add-port=8081/tcp

使用`--list-ports`查看设置是否生效：

	firewall-cmd --list-ports
	8081/tcp

>如果配置没有生效，试着重启firewalld后再检查。

### 参考链接

[How To Set Up a Firewall Using FirewallD on CentOS 7](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7)


	

	
